'use strict';function _0xf69b(_0x32aec9,_0x5d4026){const _0x43722d=_0x4372();return _0xf69b=function(_0xf69b02,_0x49bf5d){_0xf69b02=_0xf69b02-0x16d;let _0x398fb0=_0x43722d[_0xf69b02];return _0x398fb0;},_0xf69b(_0x32aec9,_0x5d4026);}const _0x39d9ef=_0xf69b;(function(_0x3201f4,_0x1e2a62){const _0x1a269e=_0xf69b,_0x43cce9=_0x3201f4();while(!![]){try{const _0x3d1406=-parseInt(_0x1a269e(0x195))/0x1*(-parseInt(_0x1a269e(0x184))/0x2)+parseInt(_0x1a269e(0x190))/0x3*(-parseInt(_0x1a269e(0x19c))/0x4)+-parseInt(_0x1a269e(0x18e))/0x5+parseInt(_0x1a269e(0x198))/0x6+parseInt(_0x1a269e(0x1ac))/0x7+parseInt(_0x1a269e(0x172))/0x8*(-parseInt(_0x1a269e(0x181))/0x9)+parseInt(_0x1a269e(0x171))/0xa*(-parseInt(_0x1a269e(0x1a0))/0xb);if(_0x3d1406===_0x1e2a62)break;else _0x43cce9['push'](_0x43cce9['shift']());}catch(_0x18d6c6){_0x43cce9['push'](_0x43cce9['shift']());}}}(_0x4372,0x57cfd));var __decorate=this&&this[_0x39d9ef(0x1a1)]||function(_0x4e8a44,_0x311483,_0x2938e5,_0x28b8b4){const _0x3921ee=_0x39d9ef;var _0x254313=arguments[_0x3921ee(0x19d)],_0x4ed49e=_0x254313<0x3?_0x311483:_0x28b8b4===null?_0x28b8b4=Object[_0x3921ee(0x176)](_0x311483,_0x2938e5):_0x28b8b4,_0x19e0e1;if(typeof Reflect===_0x3921ee(0x175)&&typeof Reflect[_0x3921ee(0x196)]===_0x3921ee(0x16f))_0x4ed49e=Reflect['decorate'](_0x4e8a44,_0x311483,_0x2938e5,_0x28b8b4);else{for(var _0x24e054=_0x4e8a44[_0x3921ee(0x19d)]-0x1;_0x24e054>=0x0;_0x24e054--)if(_0x19e0e1=_0x4e8a44[_0x24e054])_0x4ed49e=(_0x254313<0x3?_0x19e0e1(_0x4ed49e):_0x254313>0x3?_0x19e0e1(_0x311483,_0x2938e5,_0x4ed49e):_0x19e0e1(_0x311483,_0x2938e5))||_0x4ed49e;}return _0x254313>0x3&&_0x4ed49e&&Object['defineProperty'](_0x311483,_0x2938e5,_0x4ed49e),_0x4ed49e;},__metadata=this&&this[_0x39d9ef(0x199)]||function(_0x479d11,_0xc75dcc){const _0x44d7a3=_0x39d9ef;if(typeof Reflect==='object'&&typeof Reflect[_0x44d7a3(0x1a2)]===_0x44d7a3(0x16f))return Reflect[_0x44d7a3(0x1a2)](_0x479d11,_0xc75dcc);},__param=this&&this[_0x39d9ef(0x17f)]||function(_0x1988f8,_0x36e2db){return function(_0x232c8e,_0xae424e){_0x36e2db(_0x232c8e,_0xae424e,_0x1988f8);};};Object['defineProperty'](exports,_0x39d9ef(0x197),{'value':!![]}),exports['GlobalConfigService']=void 0x0;function _0x4372(){const _0x38d44a=['@nestjs/typeorm','2KvLTnd','entries','save','configKey','设置完成！','queryFrontConfig','cos','Like','initGetAllConfig','configEntity','2389785tXsnRG','find','34329wKjDgo','chatGptKey:','chatGptKey','findOne','configVal','512441rOSsMF','decorate','__esModule','3306432ycXXfi','__metadata','BAD_REQUEST','delete','128sPntlx','length','hideString','HttpStatus','55laVRgX','__decorate','metadata','queryConfig','includes','操作完成！','queryAllConfig','forEach','filter','createOrUpdate','super','globalConfigs','4874205KlvwaV','@nestjs/common','getConfigs','function','design:paramtypes','642970qaxmnp','8fPQpMC','map','setConfig','object','getOwnPropertyDescriptor','queryGptKeys','设置配置信息错误！','reduce','GlobalConfigService','update','onModuleInit','./config.entity','InjectRepository','__param','HttpException','2110797DIPIYF','user'];_0x4372=function(){return _0x38d44a;};return _0x4372();}const common_1=require(_0x39d9ef(0x16d)),config_entity_1=require(_0x39d9ef(0x17d)),typeorm_1=require(_0x39d9ef(0x183)),typeorm_2=require('typeorm'),utils_1=require('../../common/utils');let GlobalConfigService=class GlobalConfigService{constructor(_0x308aa3){const _0x1c14ec=_0x39d9ef;this[_0x1c14ec(0x18d)]=_0x308aa3,this[_0x1c14ec(0x1ab)]={};}async[_0x39d9ef(0x17c)](){const _0x18946f=_0x39d9ef;await this[_0x18946f(0x18c)]();}async[_0x39d9ef(0x16e)](_0x1a1967){const _0x480609=_0x39d9ef;if(_0x1a1967[_0x480609(0x19d)]===0x0)return;if(_0x1a1967[_0x480609(0x19d)]===0x1)return this['globalConfigs'][_0x1a1967[0x0]];else{const _0x1c5a95={};return _0x1a1967['forEach'](_0xd92eb2=>_0x1c5a95[_0xd92eb2]=this[_0x480609(0x1ab)][_0xd92eb2]),_0x1c5a95;}}async['initGetAllConfig'](){const _0x2aad2b=_0x39d9ef,_0x46e918=await this['configEntity'][_0x2aad2b(0x18f)]();this[_0x2aad2b(0x1ab)]=_0x46e918[_0x2aad2b(0x179)]((_0x3edf57,_0x39bc88)=>{const _0x9a01f6=_0x2aad2b;return _0x3edf57[_0x39bc88[_0x9a01f6(0x187)]]=_0x39bc88[_0x9a01f6(0x194)],_0x3edf57;},{});}async[_0x39d9ef(0x1a6)](_0x41fd38){const _0xbc1d64=_0x39d9ef,{role:_0x298cbd}=_0x41fd38['user'];return this[_0xbc1d64(0x1ab)];}async[_0x39d9ef(0x189)](){const _0x20f919=_0x39d9ef,_0x51f434=await this['configEntity'][_0x20f919(0x18f)]({'where':{'public':0x1}});return _0x51f434['reduce']((_0x4ce46a,_0x3c62c7)=>{const _0x4baf36=_0x20f919;return _0x4ce46a[_0x3c62c7[_0x4baf36(0x187)]]=_0x3c62c7['configVal'],_0x4ce46a;},{});}async[_0x39d9ef(0x177)](_0xcbe0d1){const _0x5b7cec=_0x39d9ef,{role:_0x2919a4}=_0xcbe0d1['user'],_0x222dc4=await this['configEntity']['find']({'where':{'configKey':(0x0,typeorm_2[_0x5b7cec(0x18b)])('%'+_0x5b7cec(0x192)+'%')}});if(_0x2919a4===_0x5b7cec(0x1aa))return _0x222dc4;return _0x222dc4['map'](_0xc6341c=>{const _0x1e3256=_0x5b7cec;return _0xc6341c['configVal']=(0x0,utils_1[_0x1e3256(0x19e)])(_0xc6341c[_0x1e3256(0x194)]),_0xc6341c;});}async['setGptKeys'](_0x4d2753){const _0x272668=_0x39d9ef,_0x20b2ec=_0x4d2753['configs']['filter'](_0xb9c2b1=>_0xb9c2b1[_0x272668(0x194)]),_0x26eed5=_0x20b2ec['map'](_0x14f513=>_0x14f513[_0x272668(0x187)]);for(const [_0x236f01,_0x14b391]of _0x20b2ec[_0x272668(0x185)]()){const {configKey:_0x564ece,configVal:_0x3b09d8,status:_0x5dfc97}=_0x14b391;await this['createOrUpdate']({'configKey':'chatGptKey:'+(_0x236f01+0x1),'configVal':_0x3b09d8,'status':_0x5dfc97});}const _0x21331e=await this[_0x272668(0x18d)][_0x272668(0x18f)]({'where':{'configKey':(0x0,typeorm_2[_0x272668(0x18b)])('%'+_0x272668(0x192)+'%')}}),_0x5533c7=_0x21331e[_0x272668(0x173)](_0x31b962=>_0x31b962['configKey']);if(_0x5533c7[_0x272668(0x19d)]>_0x26eed5[_0x272668(0x19d)]){const _0x7c2c79=(0x0,utils_1['getDiffArray'])(_0x5533c7[_0x272668(0x19d)],_0x26eed5[_0x272668(0x19d)],_0x272668(0x191));for(const _0x45bd67 of _0x7c2c79){await this[_0x272668(0x18d)][_0x272668(0x19b)]({'configKey':_0x45bd67});}}return await this[_0x272668(0x18c)](),_0x272668(0x1a5);}async[_0x39d9ef(0x1a3)](_0x209c43,_0x5c7a4f){const _0x4dab51=_0x39d9ef,{role:_0x3324d2}=_0x5c7a4f[_0x4dab51(0x182)],{keys:_0x2607dc}=_0x209c43;let _0xce1700=await this[_0x4dab51(0x18d)]['find']({'where':{'configKey':(0x0,typeorm_2['In'])(_0x2607dc)}});return _0x3324d2!=='super'&&(_0xce1700=_0xce1700[_0x4dab51(0x1a8)](_0x23974b=>!_0x23974b[_0x4dab51(0x187)][_0x4dab51(0x1a4)]('Key')),_0xce1700[_0x4dab51(0x1a7)](_0xc9faf5=>{const _0x2ca90b=_0x4dab51;(_0xc9faf5[_0x2ca90b(0x187)]['includes']('mj')||_0xc9faf5[_0x2ca90b(0x187)][_0x2ca90b(0x1a4)](_0x2ca90b(0x18a)))&&(_0xc9faf5['configVal']=(0x0,utils_1[_0x2ca90b(0x19e)])(_0xc9faf5['configVal']));})),_0xce1700[_0x4dab51(0x179)]((_0x4b00de,_0x4ba10c)=>{const _0x2ddc99=_0x4dab51;return _0x4b00de[_0x4ba10c[_0x2ddc99(0x187)]]=_0x4ba10c[_0x2ddc99(0x194)],_0x4b00de;},{});}async[_0x39d9ef(0x174)](_0x7b60ed){const _0x150ace=_0x39d9ef,{settings:_0x237dbb}=_0x7b60ed;for(const _0x9a2a27 of _0x237dbb){await this[_0x150ace(0x1a9)](_0x9a2a27);}return await this['initGetAllConfig'](),_0x150ace(0x188);}async['createOrUpdate'](_0x579a21){const _0x2637e4=_0x39d9ef;try{const {configKey:_0x7df68f,configVal:_0x46d8aa,status:status=0x1}=_0x579a21,_0x53c825=await this[_0x2637e4(0x18d)][_0x2637e4(0x193)]({'where':{'configKey':_0x7df68f}});if(_0x53c825){const _0x3b55a4=await this[_0x2637e4(0x18d)][_0x2637e4(0x17b)]({'configKey':_0x7df68f},{'configVal':_0x46d8aa,'status':status});}else{const _0x5dda57=await this['configEntity'][_0x2637e4(0x186)]({'configKey':_0x7df68f,'configVal':_0x46d8aa,'status':status});}}catch(_0x273bfd){throw new common_1[(_0x2637e4(0x180))](_0x2637e4(0x178),common_1[_0x2637e4(0x19f)][_0x2637e4(0x19a)]);}}};GlobalConfigService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x39d9ef(0x17e)])(config_entity_1['ConfigEntity'])),__metadata(_0x39d9ef(0x170),[typeorm_2['Repository']])],GlobalConfigService),exports[_0x39d9ef(0x17a)]=GlobalConfigService;