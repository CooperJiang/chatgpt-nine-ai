'use strict';const _0x29b71e=_0x4059;(function(_0x16097a,_0x5c61b3){const _0x2a4aab=_0x4059,_0xf3f421=_0x16097a();while(!![]){try{const _0x46c7e1=parseInt(_0x2a4aab(0xe8))/0x1+parseInt(_0x2a4aab(0xe3))/0x2+-parseInt(_0x2a4aab(0x10a))/0x3+parseInt(_0x2a4aab(0x10e))/0x4*(parseInt(_0x2a4aab(0xf6))/0x5)+-parseInt(_0x2a4aab(0xce))/0x6+-parseInt(_0x2a4aab(0x113))/0x7*(-parseInt(_0x2a4aab(0xd4))/0x8)+parseInt(_0x2a4aab(0xe4))/0x9*(-parseInt(_0x2a4aab(0x10f))/0xa);if(_0x46c7e1===_0x5c61b3)break;else _0xf3f421['push'](_0xf3f421['shift']());}catch(_0x464576){_0xf3f421['push'](_0xf3f421['shift']());}}}(_0x1ba4,0x59975));function _0x1ba4(){const _0xc86d43=['login','InjectRepository','length','savaLoginIp','configEntity','userId','getOwnPropertyDescriptor','MailerService','registerFailEmailTeamName','decorate','864228gVKZfX','registerSuccessEmailTeamName','getUserInfo','VerificationEnum','724wkkMGR','8216420fJioLM','log','&registerFailEmailTitle=','Injectable','791ZpyGnh','updateUserStatus','jwtService','configVal','__metadata','&registerSuccessEmaileAppend=','../globalConfig/config.entity','../user/user.service','reduce','BAD_REQUEST','账户已被激活过','object','registerFailEmailTitle','密码修改成功','error:\x20','toString','3937050VAWNHb','../mailer/mailer.service','&email=','HttpStatus','@nestjs/jwt','registerSuccessEmailTitle','46232VCHQkM','@nestjs/common','../../common/utils','qureyUserInfoByInviteCode','HttpException','user','metadata','getClientIp','getUserStatus','defineProperty','Repository','sign','userBalanceService','@nestjs/typeorm','ACTIVE','1419282Hbdfoy','9MdauTo','__esModule','../userBalance/userBalance.service','UserStatusEnum','248186TaaxJg','updateUserPassword','registerSuccessEmaileAppend','VerificationService','/api/auth/registerSuccess?id=','ConfigEntity','&username=','AuthService','oldPassword','mailerService','UserBalanceService','password','verifyUserPassword','typeorm','14420qqNYGz','userService','&registerSuccessEmailTitle=','queryUserInfoById','updatePassword','../../common/constants/verification.constant','find','__param','verificationService','/api/auth/registerError?message='];_0x1ba4=function(){return _0xc86d43;};return _0x1ba4();}var __decorate=this&&this['__decorate']||function(_0x8576f1,_0x33ffa4,_0x2a974c,_0x1ec899){const _0x2af59f=_0x4059;var _0x2dbab2=arguments[_0x2af59f(0x102)],_0x5b824e=_0x2dbab2<0x3?_0x33ffa4:_0x1ec899===null?_0x1ec899=Object[_0x2af59f(0x106)](_0x33ffa4,_0x2a974c):_0x1ec899,_0x5e3302;if(typeof Reflect===_0x2af59f(0xc9)&&typeof Reflect[_0x2af59f(0x109)]==='function')_0x5b824e=Reflect['decorate'](_0x8576f1,_0x33ffa4,_0x2a974c,_0x1ec899);else{for(var _0x53a146=_0x8576f1['length']-0x1;_0x53a146>=0x0;_0x53a146--)if(_0x5e3302=_0x8576f1[_0x53a146])_0x5b824e=(_0x2dbab2<0x3?_0x5e3302(_0x5b824e):_0x2dbab2>0x3?_0x5e3302(_0x33ffa4,_0x2a974c,_0x5b824e):_0x5e3302(_0x33ffa4,_0x2a974c))||_0x5b824e;}return _0x2dbab2>0x3&&_0x5b824e&&Object[_0x2af59f(0xdd)](_0x33ffa4,_0x2a974c,_0x5b824e),_0x5b824e;},__metadata=this&&this[_0x29b71e(0x117)]||function(_0x2f8350,_0x1109e6){const _0x4dbf5f=_0x29b71e;if(typeof Reflect==='object'&&typeof Reflect[_0x4dbf5f(0xda)]==='function')return Reflect[_0x4dbf5f(0xda)](_0x2f8350,_0x1109e6);},__param=this&&this[_0x29b71e(0xfd)]||function(_0x488c36,_0x22d1a3){return function(_0x42b242,_0x182b29){_0x22d1a3(_0x42b242,_0x182b29,_0x488c36);};};Object[_0x29b71e(0xdd)](exports,_0x29b71e(0xe5),{'value':!![]}),exports[_0x29b71e(0xef)]=void 0x0;function _0x4059(_0x5d875f,_0x3855e9){const _0x1ba4d0=_0x1ba4();return _0x4059=function(_0x405945,_0x5efb8c){_0x405945=_0x405945-0xc6;let _0x3141d8=_0x1ba4d0[_0x405945];return _0x3141d8;},_0x4059(_0x5d875f,_0x3855e9);}const verification_constant_1=require(_0x29b71e(0xfb)),verification_service_1=require('./../verification/verification.service'),common_1=require(_0x29b71e(0xd5)),jwt_1=require(_0x29b71e(0xd2)),user_service_1=require(_0x29b71e(0x11a)),mailer_service_1=require(_0x29b71e(0xcf)),user_constant_1=require('../../common/constants/user.constant'),userBalance_service_1=require(_0x29b71e(0xe6)),config_entity_1=require(_0x29b71e(0x119)),typeorm_1=require(_0x29b71e(0xf5)),typeorm_2=require(_0x29b71e(0xe1)),utils_1=require(_0x29b71e(0xd6));let AuthService=class AuthService{constructor(_0x1210a3,_0xd0c049,_0x485495,_0x1154a3,_0x3d4425,_0x3e7256){const _0x3c1c71=_0x29b71e;this[_0x3c1c71(0xf7)]=_0x1210a3,this['jwtService']=_0xd0c049,this[_0x3c1c71(0xf1)]=_0x485495,this[_0x3c1c71(0xfe)]=_0x1154a3,this[_0x3c1c71(0xe0)]=_0x3d4425,this[_0x3c1c71(0x104)]=_0x3e7256;}async['register'](_0x59b374,_0x225255){const _0x3af8b2=_0x29b71e,_0x43aa75=await this[_0x3af8b2(0xf7)]['createUserAndVerifycation'](_0x59b374,_0x225255),{username:_0x2e13dc,email:_0x2b1792}=_0x43aa75;return{'username':_0x2e13dc,'email':_0x2b1792};}async[_0x29b71e(0x100)](_0x1788b2,_0x4577f3){const _0x626987=_0x29b71e,_0x31ba5a=await this[_0x626987(0xf7)]['verifyUserCredentials'](_0x1788b2),{username:_0x5d75f6,id:_0x5885ff,email:_0xbb6127,role:_0x54b270}=_0x31ba5a,_0x3e6680=(0x0,utils_1[_0x626987(0xdb)])(_0x4577f3);return console[_0x626987(0x110)]('ip:\x20',_0x3e6680),await this[_0x626987(0xf7)][_0x626987(0x103)](_0x5885ff,_0x3e6680),this[_0x626987(0x115)][_0x626987(0xdf)]({'username':_0x5d75f6,'id':_0x5885ff,'email':_0xbb6127,'role':_0x54b270});}async['getInfo'](_0x366c0f){const _0x3b38f8=_0x29b71e,{id:_0x3d8814}=_0x366c0f[_0x3b38f8(0xd9)];return await this[_0x3b38f8(0xf7)][_0x3b38f8(0x10c)](_0x3d8814);}async['activateAccount'](_0xf04973,_0xf07dd2){const _0x4d9d1a=_0x29b71e,_0x595e82=await this[_0x4d9d1a(0x104)][_0x4d9d1a(0xfc)]({'where':{'configKey':(0x0,typeorm_1['In'])([_0x4d9d1a(0xd3),_0x4d9d1a(0x10b),_0x4d9d1a(0xea),_0x4d9d1a(0xca),_0x4d9d1a(0x108)])}}),_0x55a7de=_0x595e82[_0x4d9d1a(0xc6)]((_0x3c289a,_0x56fb6e)=>{const _0x33ac14=_0x4d9d1a;return _0x3c289a[_0x56fb6e['configKey']]=_0x56fb6e[_0x33ac14(0x116)],_0x3c289a;},{});try{const _0xc407cb=await this[_0x4d9d1a(0xfe)]['verifyCode'](_0xf04973),{type:_0x8ad91a,userId:_0x1d2ae0}=_0xc407cb;if(_0x8ad91a!==verification_constant_1[_0x4d9d1a(0x10d)]['Registration'])throw new common_1[(_0x4d9d1a(0xd8))]('验证码类型错误',common_1[_0x4d9d1a(0xd1)][_0x4d9d1a(0xc7)]);const _0x1a2e5b=await this[_0x4d9d1a(0xf7)][_0x4d9d1a(0xdc)](_0x1d2ae0);if(_0x1a2e5b===user_constant_1[_0x4d9d1a(0xe7)][_0x4d9d1a(0xe2)])throw new common_1[(_0x4d9d1a(0xd8))](_0x4d9d1a(0xc8),common_1[_0x4d9d1a(0xd1)][_0x4d9d1a(0xc7)]);await this['userService'][_0x4d9d1a(0x114)](_0xc407cb[_0x4d9d1a(0x105)],user_constant_1[_0x4d9d1a(0xe7)][_0x4d9d1a(0xe2)]);const _0x51427c=await this[_0x4d9d1a(0xf7)][_0x4d9d1a(0xf9)](_0xc407cb[_0x4d9d1a(0x105)]),{username:_0x491ea4,email:_0x4650f2,id:_0x10b3d4,invitedBy:_0x2c296b}=_0x51427c;let _0x49544a;_0x2c296b&&(_0x49544a=await this[_0x4d9d1a(0xf7)][_0x4d9d1a(0xd7)](_0x2c296b)),await this[_0x4d9d1a(0xe0)]['addBalanceToNewUser'](_0x10b3d4,_0x49544a===null||_0x49544a===void 0x0?void 0x0:_0x49544a['id']),_0xf07dd2['redirect'](_0x4d9d1a(0xec)+_0x10b3d4[_0x4d9d1a(0xcd)]()['padStart'](0x4,'0')+_0x4d9d1a(0xee)+_0x491ea4+_0x4d9d1a(0xd0)+_0x4650f2+_0x4d9d1a(0xf8)+_0x55a7de[_0x4d9d1a(0xd3)]+'&registerSuccessEmailTeamName='+_0x55a7de['registerSuccessEmailTeamName']+_0x4d9d1a(0x118)+_0x55a7de[_0x4d9d1a(0xea)]);}catch(_0x34e267){console[_0x4d9d1a(0x110)](_0x4d9d1a(0xcc),_0x34e267);const _0x540bd4=_0x34e267['response'];_0xf07dd2['redirect'](_0x4d9d1a(0xff)+_0x540bd4+_0x4d9d1a(0x111)+_0x55a7de[_0x4d9d1a(0xca)]+'&registerFailEmailTeamName='+_0x55a7de[_0x4d9d1a(0x108)]);}}async[_0x29b71e(0xfa)](_0x525424,_0x2cf7d1){const _0x15650e=_0x29b71e,{id:_0xf5ff80}=_0x525424[_0x15650e(0xd9)],_0x25def5=await this[_0x15650e(0xf7)][_0x15650e(0xf4)](_0xf5ff80,_0x2cf7d1[_0x15650e(0xf0)]);if(!_0x25def5)throw new common_1['HttpException']('旧密码错误、请检查提交',common_1['HttpStatus'][_0x15650e(0xc7)]);return this[_0x15650e(0xf7)][_0x15650e(0xe9)](_0xf5ff80,_0x2cf7d1[_0x15650e(0xf3)]),_0x15650e(0xcb);}};AuthService=__decorate([(0x0,common_1[_0x29b71e(0x112)])(),__param(0x5,(0x0,typeorm_2[_0x29b71e(0x101)])(config_entity_1[_0x29b71e(0xed)])),__metadata('design:paramtypes',[user_service_1['UserService'],jwt_1['JwtService'],mailer_service_1[_0x29b71e(0x107)],verification_service_1[_0x29b71e(0xeb)],userBalance_service_1[_0x29b71e(0xf2)],typeorm_1[_0x29b71e(0xde)]])],AuthService),exports['AuthService']=AuthService;