
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as me}from"./index-56b33bff.js";import{A as h}from"./package-d4e90f70.js";import{d as fe,r as f,Q as I,B as _e,x as be,o as i,c as U,e as l,f as a,N as q,R as A,b as n,k as c,a as Y,I as b,J as x,w as ge,t as D,S as ye,U as F,Y as ve,E as R,h as r,X as Ce,q as O}from"./index-be23d7e6.js";import{C as we}from"./index-68385382.js";const ke={style:{float:"right"}},Ve={key:1},he={class:"dialog-footer"},Ue=fe({__name:"crami",setup(xe){const M=f(),N=f(0),v=f(!1),L=f(),C=f(0),S=f([]),T=f([]),g=f(!1),w=f([]),u=I({packageId:null,count:1,days:0,balance:0,usesLeft:0,paintCount:0}),m=I({useId:"",status:"",page:1,size:10}),J=I({packageId:[{required:!0,message:"请选择套餐类型",trigger:"change"}],days:[{required:!0,message:"请填写有效期天数",trigger:"blur"}],count:[{required:!0,message:"请填写想要生成的数量",trigger:"blur"}],balance:[{required:!0,message:"请填写卡密携带金额",trigger:"blur"}],usesLeft:[{required:!0,message:"请填写卡密携带对话数量",trigger:"blur"}],paintCount:[{required:!0,message:"请填写卡密携带绘画数量",trigger:"blur"}]}),z=f([]);async function _(){try{g.value=!0;const o=await h.queryAllCrami(m),{rows:t,count:y}=o.data;g.value=!1,N.value=y,z.value=t}catch{g.value=!1}}async function Q(o){const t=await ve.queryAllUser({size:30,username:o});T.value=t.data.rows}async function X(){const o=await h.queryAllPackage({size:100});S.value=o.data.rows}function G(){X(),v.value=!0}async function H(o){o==null||o.validate(async t=>{t&&(await h.createCrami(u),R({type:"success",message:"生成卡密成功！"}),v.value=!1,_())})}function K(o){o==null||o.resetFields()}function W(o){o==null||o.resetFields(),_()}async function Z({id:o}){await h.delCrami({id:o}),R({type:"success",message:"删除卡密成功！"}),_()}async function E(o){w.value=o}async function ee(){try{g.value=!0,await h.batchDelCrami({ids:w.value.map(o=>o.id)}),g.value=!1,R({type:"success",message:"删除卡密成功！"}),_()}catch{g.value=!1}}function le(o){return o.join(`
`)}function te(o,t){const y=le(o),k=new Blob([y],{type:"text/plain"}),d=URL.createObjectURL(k),s=document.createElement("a");s.href=d,s.download=`${t}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(d),0)}function ae(){const o=w.value.map(t=>`${t.code}<---->${t.packageName||"自定义套餐"}`);te(o,"卡密信息")}const oe=_e(()=>z.value.some(o=>o.email));return be(()=>{_()}),(o,t)=>{const y=r("el-option"),k=r("el-select"),d=r("el-form-item"),s=r("el-button"),ne=r("Plus"),re=r("el-icon"),$=r("el-form"),P=me,p=r("el-table-column"),B=r("el-tag"),ue=r("el-popconfirm"),se=r("el-table"),de=r("el-pagination"),j=r("el-row"),ie=r("el-switch"),V=r("el-input"),pe=r("el-dialog"),ce=Ce("loading");return i(),U("div",null,[l(P,null,{default:a(()=>[l($,{ref_key:"formRef",ref:M,inline:!0,model:m},{default:a(()=>[l(d,{label:"用户名称",prop:"useId"},{default:a(()=>[l(k,{modelValue:m.useId,"onUpdate:modelValue":t[0]||(t[0]=e=>m.useId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":Q},{default:a(()=>[(i(!0),U(q,null,A(n(T),e=>(i(),b(y,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"卡密状态",prop:"status"},{default:a(()=>[l(k,{modelValue:m.status,"onUpdate:modelValue":t[1]||(t[1]=e=>m.status=e),placeholder:"请选择卡密状态",clearable:""},{default:a(()=>[(i(!0),U(q,null,A(n(we),e=>(i(),b(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(s,{type:"primary",onClick:_},{default:a(()=>[c(" 查询 ")]),_:1}),l(s,{onClick:t[2]||(t[2]=e=>W(n(M)))},{default:a(()=>[c(" 重置 ")]),_:1})]),_:1}),Y("div",ke,[n(w).length?(i(),b(s,{key:0,type:"danger",onClick:ee},{default:a(()=>[c(" 批量删除卡密 ")]),_:1})):x("",!0),n(w).length?(i(),b(s,{key:1,type:"primary",onClick:ae},{default:a(()=>[c(" 批量导出卡密 ")]),_:1})):x("",!0),l(s,{type:"success",onClick:G},{default:a(()=>[c(" 批量生成卡密 "),l(re,{class:"ml-3"},{default:a(()=>[l(ne)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),l(P,{style:{width:"100%"}},{default:a(()=>[ge((i(),b(se,{border:"",data:n(z),style:{width:"100%"},size:"large",onSelectionChange:E},{default:a(()=>[l(p,{type:"selection",width:"55"}),l(p,{prop:"code",label:"卡密账号",width:"180"}),l(p,{prop:"packageName",label:"套餐类型",width:"180"},{default:a(e=>[l(B,{type:e.row.packageName?"success":"danger"},{default:a(()=>[c(D(e.row.packageName||"自定义卡密"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"code",label:"卡密状态",width:"180"},{default:a(e=>[l(B,{type:e.row.status?"danger":"success"},{default:a(()=>[c(D(e.row.status?"已使用":"未使用"),1)]),_:2},1032,["type"])]),_:1}),n(oe)?(i(),b(p,{key:0,prop:"email",label:"使用人邮箱",width:"180"})):x("",!0),l(p,{prop:"usesLeft",label:"对话余额"}),l(p,{prop:"paintCount",label:"绘画余额"}),l(p,{prop:"balance",label:"账户金额"}),l(p,{prop:"days",label:"有效天数"}),l(p,{prop:"createdAt",label:"注册时间",width:"200"},{default:a(e=>[c(D(n(ye)(new Date(e.row.createdAt),"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),l(p,{label:"操作"},{default:a(e=>[l(ue,{title:"确认删除此卡密么?",width:"200","icon-color":"red",onConfirm:Le=>Z(e.row)},{reference:a(()=>[l(s,{link:"",type:"danger",size:"small"},{default:a(()=>[c(" 删除卡密 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[ce,n(g)]]),l(j,{class:"flex justify-end mt-5"},{default:a(()=>[l(de,{"current-page":m.page,"onUpdate:currentPage":t[3]||(t[3]=e=>m.page=e),"page-size":m.size,"onUpdate:pageSize":t[4]||(t[4]=e=>m.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:n(N),onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(pe,{modelValue:n(v),"onUpdate:modelValue":t[14]||(t[14]=e=>F(v)?v.value=e:null),title:"生成卡密",width:"450",onClose:t[15]||(t[15]=e=>K(n(L)))},{footer:a(()=>[Y("span",he,[l(s,{onClick:t[12]||(t[12]=e=>v.value=!1)},{default:a(()=>[c("放弃生成")]),_:1}),l(s,{type:"primary",onClick:t[13]||(t[13]=e=>H(n(L)))},{default:a(()=>[c(" 确定生成 ")]),_:1})])]),default:a(()=>[l($,{ref_key:"formCramiRef",ref:L,"label-position":"right","label-width":"100px",model:u,rules:J},{default:a(()=>[l(j,null,{default:a(()=>[l(d,{label:"是否生成自定义卡密","label-width":"170px"},{default:a(()=>[l(ie,{modelValue:n(C),"onUpdate:modelValue":t[5]||(t[5]=e=>F(C)?C.value=e:null),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1}),n(C)?x("",!0):(i(),b(d,{key:0,label:"套餐类型",prop:"packageId"},{default:a(()=>[l(k,{modelValue:u.packageId,"onUpdate:modelValue":t[6]||(t[6]=e=>u.packageId=e),modelModifiers:{number:!0},placeholder:"请选择套餐类型",clearable:"",style:{width:"100%"}},{default:a(()=>[(i(!0),U(q,null,A(n(S),e=>(i(),b(y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),n(C)?(i(),U("div",Ve,[l(d,{label:"有效天数",prop:"days"},{default:a(()=>[l(V,{modelValue:u.days,"onUpdate:modelValue":t[7]||(t[7]=e=>u.days=e),modelModifiers:{number:!0},type:"number",placeholder:"生成后的有效期天数、不填或0就是永久"},null,8,["modelValue"])]),_:1}),l(d,{label:"对话次数",prop:"usesLeft"},{default:a(()=>[l(V,{modelValue:u.usesLeft,"onUpdate:modelValue":t[8]||(t[8]=e=>u.usesLeft=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带对话次数"},null,8,["modelValue"])]),_:1}),l(d,{label:"绘画次数",prop:"paintCount"},{default:a(()=>[l(V,{modelValue:u.paintCount,"onUpdate:modelValue":t[9]||(t[9]=e=>u.paintCount=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带绘画次数"},null,8,["modelValue"])]),_:1}),l(d,{label:"账户金额",prop:"balance"},{default:a(()=>[l(V,{modelValue:u.balance,"onUpdate:modelValue":t[10]||(t[10]=e=>u.balance=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带账户金额"},null,8,["modelValue"])]),_:1})])):x("",!0),l(d,{label:"生成数量",prop:"count"},{default:a(()=>[l(V,{modelValue:u.count,"onUpdate:modelValue":t[11]||(t[11]=e=>u.count=e),modelModifiers:{number:!0},type:"number",placeholder:"本次生成的张数"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});typeof O=="function"&&O(Ue);export{Ue as default};
