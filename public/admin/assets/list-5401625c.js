
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as se}from"./index-56b33bff.js";import{A as T}from"./chatgpt-9ae62d42.js";import{M as ue,c as re,d as R,Q as de,K as ie,A as pe}from"./index-68385382.js";import{d as me,r as c,Q as z,B as Y,x as ce,o as i,c as V,e as l,f as a,N as A,R as h,b as n,k as p,w as $,I as w,t as C,S as ye,a as fe,U as _e,E as q,W as ge,h as u,X as ke,q as G}from"./index-be23d7e6.js";const ve={class:"flex justify-end mr-5"},be=me({__name:"list",setup(we){const D=c(),L=c(0),y=c(!1),S=c(!1),U=c(!1),K=c([]),r=z({key:"",model:"",status:"",page:1,size:10}),M=c(),g=c(0),s=z({key:"",model:"",weight:1,type:"",status:1}),j=z({key:[{required:!0,message:"请填写您的chatgpt key",trigger:"blur"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],type:[{required:!0,message:"请选择当前账号余额类型",trigger:"change"}],weight:[{required:!1,message:"请填写key的权重值",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}]});function Q(o){g.value=0,o==null||o.resetFields()}const F=Y(()=>g.value?"更新秘钥":"新增秘钥"),W=Y(()=>g.value?"确认更新":"确认新增"),N=c([]);async function B(){if(!s.key)return q.error("请先填写您的key再查询");s.model="";try{U.value=!0;const o=await T.queryKeyModelList({key:s.key});U.value=!1,K.value=o.data}catch{U.value=!1}}async function k(){try{S.value=!0;const o=await T.queryKeyList(r);S.value=!1;const{rows:t,count:f}=o.data;L.value=f,N.value=t}catch{S.value=!1}}function X(o){g.value=o.id;const{key:t,model:f,weight:d,status:v,type:b}=o;ge(()=>{Object.assign(s,{key:t,model:f,weight:d,status:v,type:b})}),y.value=!0}function E(o){o==null||o.resetFields(),k()}async function H(o){o==null||o.validate(async t=>{t&&(g.value?(await T.updateGptKey({id:g.value,...s}),q({type:"success",message:"更新秘钥成功！"})):(await T.addGptKey(s),q({type:"success",message:"添加秘钥成功！"})),y.value=!1,k())})}return ce(()=>{k()}),(o,t)=>{const f=u("el-input"),d=u("el-form-item"),v=u("el-option"),b=u("el-select"),_=u("el-button"),J=u("Plus"),Z=u("el-icon"),I=u("el-form"),P=se,ee=u("el-alert"),m=u("el-table-column"),x=u("el-tag"),le=u("el-table"),te=u("el-pagination"),ae=u("el-row"),oe=u("el-switch"),ne=u("el-dialog"),O=ke("loading");return i(),V("div",null,[l(P,null,{default:a(()=>[l(I,{ref_key:"formRef",ref:D,inline:!0,model:r},{default:a(()=>[l(d,{label:"key",prop:"key"},{default:a(()=>[l(f,{modelValue:r.key,"onUpdate:modelValue":t[0]||(t[0]=e=>r.key=e),placeholder:"sk-*** [模糊搜索]"},null,8,["modelValue"])]),_:1}),l(d,{label:"使用模型",prop:"model"},{default:a(()=>[l(b,{modelValue:r.model,"onUpdate:modelValue":t[1]||(t[1]=e=>r.model=e),placeholder:"请选择绑定的模型",clearable:""},{default:a(()=>[(i(!0),V(A,null,h(n(ue),e=>(i(),w(v,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"启用状态",prop:"status"},{default:a(()=>[l(b,{modelValue:r.status,"onUpdate:modelValue":t[2]||(t[2]=e=>r.status=e),placeholder:"请选择key启用状态",clearable:""},{default:a(()=>[(i(!0),V(A,null,h(n(re),e=>(i(),w(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(_,{type:"primary",onClick:k},{default:a(()=>[p(" 查询 ")]),_:1}),l(_,{onClick:t[3]||(t[3]=e=>E(n(D)))},{default:a(()=>[p(" 重置 ")]),_:1})]),_:1}),l(_,{type:"success",style:{float:"right"},onClick:t[4]||(t[4]=e=>y.value=!0)},{default:a(()=>[p(" 添加Key "),l(Z,{class:"ml-3"},{default:a(()=>[l(J)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(P,null,{default:a(()=>[l(ee,{"show-icon":"",title:"Gpt4模型设置说明",description:"当前版本Gpt-4模型不开放给用户自主选择、手动设置白名单用户开放部分用户使用Gpt4模型、下个小版本变更为用户自由切换交互且更改计费规则！",type:"warning"})]),_:1}),l(P,{style:{width:"100%"}},{default:a(()=>[$((i(),w(le,{border:"",data:n(N),style:{width:"100%"},size:"large"},{default:a(()=>[l(m,{prop:"key",label:"key秘钥",width:"470"}),l(m,{prop:"model",align:"center",label:"绑定模型",width:"200"},{default:a(e=>[l(x,{type:e.row.model.includes("gpt-4")?"success":""},{default:a(()=>[p(C(e.row.model),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"status",align:"center",label:"启用状态",width:"120"},{default:a(e=>[l(x,{type:n(R)[e.row.status]},{default:a(()=>[p(C(n(de)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"type",align:"center",label:"余额类型"}),l(m,{prop:"weight",align:"center",label:"秘钥权重"}),l(m,{prop:"useCount",align:"center",label:"调用次数"}),l(m,{prop:"keyStatus",align:"center",label:"key状态",width:"120"},{default:a(e=>[l(x,{type:n(R)[e.row.keyStatus]},{default:a(()=>[p(C(n(ie)[e.row.keyStatus]),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:a(e=>[p(C(n(ye)(new Date(e.row.createdAt),"YYYY-MM-DD")),1)]),_:1}),l(m,{fixed:"right",label:"操作"},{default:a(e=>[l(_,{link:"",type:"primary",size:"small",onClick:Ve=>X(e.row)},{default:a(()=>[p(" 变更 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,n(S)]]),l(ae,{class:"flex justify-end mt-5"},{default:a(()=>[l(te,{"current-page":r.page,"onUpdate:currentPage":t[5]||(t[5]=e=>r.page=e),"page-size":r.size,"onUpdate:pageSize":t[6]||(t[6]=e=>r.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:n(L),onSizeChange:k,onCurrentChange:k},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(ne,{modelValue:n(y),"onUpdate:modelValue":t[14]||(t[14]=e=>_e(y)?y.value=e:null),"close-on-click-modal":!1,title:n(F),width:"570",onClose:t[15]||(t[15]=e=>Q(n(M)))},{footer:a(()=>[fe("span",ve,[l(_,{onClick:t[12]||(t[12]=e=>y.value=!1)},{default:a(()=>[p("取消")]),_:1}),l(_,{type:"primary",onClick:t[13]||(t[13]=e=>H(n(M)))},{default:a(()=>[p(C(n(W)),1)]),_:1})])]),default:a(()=>[$((i(),w(I,{ref_key:"formPackageRef",ref:M,"label-position":"right","label-width":"100px",model:s,rules:j},{default:a(()=>[l(d,{label:"key卡账号",prop:"key"},{default:a(()=>[l(f,{modelValue:s.key,"onUpdate:modelValue":t[7]||(t[7]=e=>s.key=e),placeholder:"请填写chatgpt key",onBlur:B},null,8,["modelValue"])]),_:1}),l(d,{label:"启用状态",prop:"status"},{default:a(()=>[l(oe,{modelValue:s.status,"onUpdate:modelValue":t[8]||(t[8]=e=>s.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),l(d,{label:"绑定模型",prop:"model"},{default:a(()=>[l(b,{modelValue:s.model,"onUpdate:modelValue":t[9]||(t[9]=e=>s.model=e),filterable:"",clearable:"",placeholder:"请选用当前key绑定的模型"},{default:a(()=>[(i(!0),V(A,null,h(n(K),e=>(i(),w(v,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(_,{type:"primary",class:"ml-5",onClick:B},{default:a(()=>[p(" 查询当前key支持的模型 ")]),_:1})]),_:1}),l(d,{label:"账号类型",prop:"type"},{default:a(()=>[l(b,{modelValue:s.type,"onUpdate:modelValue":t[10]||(t[10]=e=>s.type=e),filterable:"",clearable:"",placeholder:"请选用当前key绑定的模型"},{default:a(()=>[(i(!0),V(A,null,h(n(pe),e=>(i(),w(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"轮询权重",prop:"weight"},{default:a(()=>[l(f,{modelValue:s.weight,"onUpdate:modelValue":t[11]||(t[11]=e=>s.weight=e),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[O,n(U)]])]),_:1},8,["modelValue","title"])])}}});typeof G=="function"&&G(be);export{be as default};
